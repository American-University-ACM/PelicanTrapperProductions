(function(e){var t={idx_expanded:-1,sliceH:0,current:0,totalSlices:0},n={selectSlice:function(r,i,s,o,u){return e.Deferred(function(a){var f=r.data("expanded"),l=r.data("position"),c,h,p=i.not(r);if(f){r.data("expanded",!1);t.idx_expanded=-1;c=t.sliceH;h=t.sliceH;r.find(".va-content").hide();n.canSlideUp(i,u)?o.fadeIn():o.fadeOut();n.canSlideDown(i,u)?s.fadeIn():s.fadeOut()}else{r.data("expanded",!0);t.idx_expanded=r.index();p.data("expanded",!1);c=u.expandedHeight;h=Math.ceil((u.accordionH-u.expandedHeight)/(u.visibleSlices-1));t.idx_expanded>0?o.fadeIn():o.fadeOut();t.idx_expanded<t.totalSlices-1?s.fadeIn():s.fadeOut()}var d={height:c+"px",opacity:1,top:(l-1)*h+"px"};r.stop().animate(d,u.animSpeed,u.animEasing,function(){f||r.find(".va-content").fadeIn(u.contentAnimSpeed)}).find(".va-title").stop().animate({lineHeight:t.sliceH+"px"},u.animSpeed,u.animEasing);p.each(function(t){var n=e(this),r=n.data("position"),i;f?i=(r-1)*h:r<l?i=(r-1)*h:i=(r-2)*h+u.expandedHeight;n.stop().animate({top:i+"px",height:h+"px",opacity:f?1:u.animOpacity},u.animSpeed,u.animEasing,a.resolve).find(".va-title").stop().animate({lineHeight:h+"px"},u.animSpeed,u.animEasing).end().find(".va-content").hide()})}).promise()},navigate:function(r,i,s,o,u){if(i.is(":animated"))return!1;var a;if(t.idx_expanded!=-1&&!u.savePositions){a=i.eq(t.idx_expanded);e.when(n.selectSlice(a,i,s,o,u)).done(function(){setTimeout(function(){n.slide(r,i,s,o,u)},10)})}else n.slide(r,i,s,o,u)},slide:function(r,i,s,o,u){if(t.idx_expanded===-1||!u.savePositions){if(r===1&&t.current+u.visibleSlices>=t.totalSlices)return!1;if(r===-1&&t.current===0)return!1;r===-1&&t.current===1?o.fadeOut():o.fadeIn();r===1&&t.current+u.visibleSlices===t.totalSlices-1?s.fadeOut():s.fadeIn()}else{if(r===1&&t.idx_expanded===t.totalSlices-1)return!1;if(r===-1&&t.idx_expanded===0)return!1;r===-1&&t.idx_expanded===1?o.fadeOut():o.fadeIn();r===1&&t.idx_expanded===t.totalSlices-2?s.fadeOut():s.fadeIn()}var a=i.eq(t.idx_expanded),f,l;r===1?f=a.next():f=a.prev();if(r===1&&!n.canSlideDown(i,u)||r===-1&&!n.canSlideUp(i,u)){n.selectSlice(f,i,s,o,u);return!1}if(r===1){t.current++;l="-="+t.sliceH;pos_increment=-1}else{t.current--;l="+="+t.sliceH;pos_increment=1}i.each(function(n){var i=e(this),s=i.data("position");if(!u.savePositions||t.idx_expanded===-1)i.stop().animate({top:l},u.animSpeed,u.animEasing);else{var o,a;if(n===f.index()){i.data("expanded",!0);t.idx_expanded=i.index();o=u.expandedHeight;a=(u.accordionH-u.expandedHeight)/(u.visibleSlices-1);i.stop().animate({height:o+"px",opacity:1,top:r===1?(s-2)*a+"px":s*a+"px"},u.animSpeed,u.animEasing,function(){i.find(".va-content").fadeIn(u.contentAnimSpeed)}).find(".va-title").stop().animate({lineHeight:t.sliceH+"px"},u.animSpeed,u.animEasing)}else if(i.data("expanded")){i.data("expanded",!1);a=(u.accordionH-u.expandedHeight)/(u.visibleSlices-1);i.stop().animate({height:a+"px",top:r===1?"-="+a:"+="+u.expandedHeight},u.animSpeed,u.animEasing).find(".va-title").stop().animate({lineHeight:a+"px"},u.animSpeed,u.animEasing).end().find(".va-content").hide()}else{i.data("expanded",!1);a=(u.accordionH-u.expandedHeight)/(u.visibleSlices-1);i.stop().animate({top:r===1?"-="+a:"+="+a},u.animSpeed,u.animEasing)}}i.data().position+=pos_increment})},canSlideUp:function(e,n){var r=e.eq(t.current);if(r.index()!==0)return!0},canSlideDown:function(e,n){var r=e.eq(t.current+n.visibleSlices-1);if(r.index()!==t.totalSlices-1)return!0}},r={init:function(r){if(this.length){var i={accordionW:1e3,accordionH:450,visibleSlices:3,expandedHeight:350,animSpeed:250,animEasing:"jswing",animOpacity:.2,contentAnimSpeed:900,savePositions:!0};return this.each(function(){r&&e.extend(i,r);var s=e(this),o=s.find("div.va-slice"),u=s.find("span.va-nav-next"),a=s.find("span.va-nav-prev");t.sliceH=Math.ceil(i.accordionH/i.visibleSlices);t.totalSlices=o.length;i.expandedHeight>i.accordionH?i.expandedHeight=i.accordionH:i.expandedHeight<=t.sliceH&&(i.expandedHeight=t.sliceH+50);s.css({width:i.accordionW+"px",height:i.accordionH+"px"});i.visibleSlices<t.totalSlices&&u.show();o.each(function(n){var r=e(this);r.css({top:n*t.sliceH+"px",height:t.sliceH+"px"}).data("position",n+1)}).children(".va-title").css("line-height",t.sliceH+"px");o.bind("click.vaccordion",function(t){if(i.visibleSlices>1){var r=e(this);n.selectSlice(r,o,u,a,i)}});u.bind("click.vaccordion",function(e){n.navigate(1,o,u,a,i)});a.bind("click.vaccordion",function(e){n.navigate(-1,o,u,a,i)});s.bind("mousewheel.vaccordion",function(e,t){t>0?n.navigate(-1,o,u,a,i):n.navigate(1,o,u,a,i);return!1})})}}};e.fn.vaccordion=function(t){if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return r.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.vaccordion")}})(jQuery);